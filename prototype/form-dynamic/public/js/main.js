(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"./scripts/main.js":[function(require,module,exports){
'use strict';

var submission = require("/Applications/MAMP/htdocs/openfoundry/prototype/form-dynamic/scripts/submission.js");
var newsletter = require("/Applications/MAMP/htdocs/openfoundry/prototype/form-dynamic/scripts/newsletter.js");

},{"/Applications/MAMP/htdocs/openfoundry/prototype/form-dynamic/scripts/newsletter.js":"/Applications/MAMP/htdocs/openfoundry/prototype/form-dynamic/scripts/newsletter.js","/Applications/MAMP/htdocs/openfoundry/prototype/form-dynamic/scripts/submission.js":"/Applications/MAMP/htdocs/openfoundry/prototype/form-dynamic/scripts/submission.js"}],"/Applications/MAMP/htdocs/openfoundry/prototype/form-dynamic/scripts/newsletter.js":[function(require,module,exports){
'use strict';

;(function () {

  var form = document.getElementById('newsletter-form');
  if (!form) {
    return;
  }

  var messageEl = form.querySelector('.final-message');

  var stepsForm = require("/Applications/MAMP/htdocs/openfoundry/prototype/form-dynamic/scripts/stepsform.js");

  new stepsForm(form, { onSubmit: onSubmit });

  function onSubmit(form) {

    // hide form
    form.querySelector('.simform-inner').classList.add('hide');

    $.ajax({
      url: '/newsletter-submit',
      type: 'post',
      dataType: 'json',
      data: $(form).serialize(),
      success: onSuccess
    });
  }

  function onSuccess(data) {
    if (data.status === 'success') {
      messageEl.innerHTML = data.message;
    } else {
      messageEl.innerHTML = data.message;
    }
    messageEl.classList.add('show');
  }
})();

},{"/Applications/MAMP/htdocs/openfoundry/prototype/form-dynamic/scripts/stepsform.js":"/Applications/MAMP/htdocs/openfoundry/prototype/form-dynamic/scripts/stepsform.js"}],"/Applications/MAMP/htdocs/openfoundry/prototype/form-dynamic/scripts/stepsform.js":[function(require,module,exports){
/**
 * stepsForm.js v1.0.0
 * http://www.codrops.com
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Copyright 2014, Codrops
 * http://www.codrops.com
 */

'use strict';

var transEndEventNames = {
  'WebkitTransition': 'webkitTransitionEnd',
  'MozTransition': 'transitionend',
  'OTransition': 'oTransitionEnd',
  'msTransition': 'MSTransitionEnd',
  'transition': 'transitionend'
},
    transEndEventName = transEndEventNames[Modernizr.prefixed('transition')],
    support = { transitions: Modernizr.csstransitions };

function extend(a, b) {
  for (var key in b) {
    if (b.hasOwnProperty(key)) {
      a[key] = b[key];
    }
  }
  return a;
}

function stepsForm(el, options) {
  this.el = el;
  this.options = extend({}, this.options);
  extend(this.options, options);
  this._init();
}

stepsForm.prototype.options = {
  onSubmit: function onSubmit() {
    return false;
  }
};

stepsForm.prototype._init = function () {
  // current question
  this.current = 0;

  // questions
  this.questions = [].slice.call(this.el.querySelectorAll('ol.questions > li'));

  // total questions
  this.questionsCount = this.questions.length;

  // show first question
  this.questions[0].classList.add('current');

  // next question control
  this.ctrlNext = this.el.querySelector('button.next');

  // progress bar
  this.progress = this.el.querySelector('div.progress');

  // question number status
  this.questionStatus = this.el.querySelector('span.number');

  // current question placeholder
  this.currentNum = this.questionStatus.querySelector('span.number-current');
  this.currentNum.innerHTML = Number(this.current + 1);

  // total questions placeholder
  this.totalQuestionNum = this.questionStatus.querySelector('span.number-total');
  this.totalQuestionNum.innerHTML = this.questionsCount;

  // error message
  this.error = this.el.querySelector('span.error-message');

  // init events
  this._initEvents();
};

stepsForm.prototype._initEvents = function () {
  var self = this,

  // first input
  firstElInput = this.questions[this.current].querySelector('input'),

  // focus
  onFocusStartFn = function onFocusStartFn() {
    firstElInput.removeEventListener('focus', onFocusStartFn);
    self.ctrlNext.classList.add('show');
  };

  // show the next question control first time the input gets focused
  firstElInput.addEventListener('focus', onFocusStartFn);

  // show next question
  this.ctrlNext.addEventListener('click', function (ev) {
    ev.preventDefault();
    self._nextQuestion();
  });

  // pressing enter will jump to next question
  document.addEventListener('keydown', function (ev) {
    var keyCode = ev.keyCode || ev.which;
    // enter
    if (keyCode === 13) {
      ev.preventDefault();
      self._nextQuestion();
    }
  });

  // disable tab
  this.el.addEventListener('keydown', function (ev) {
    var keyCode = ev.keyCode || ev.which;
    // tab
    if (keyCode === 9) {
      ev.preventDefault();
    }
  });
};

stepsForm.prototype._nextQuestion = function () {
  if (!this._validade()) {
    return false;
  }

  // check if form is filled
  if (this.current === this.questionsCount - 1) {
    this.isFilled = true;
  }

  // clear any previous error messages
  this._clearError();

  // current question
  var currentQuestion = this.questions[this.current];

  // increment current question iterator
  ++this.current;

  // update progress bar
  this._progress();

  if (!this.isFilled) {
    // change the current question number/status
    this._updateQuestionNumber();

    // add class "show-next" to form element (start animations)
    this.el.classList.add('show-next');

    // remove class "current" from current question and add it to the next one
    // current question
    var nextQuestion = this.questions[this.current];
    currentQuestion.classList.remove('current');
    nextQuestion.classList.add('current');
  }

  // after animation ends, remove class "show-next" from form element and change current question placeholder
  var self = this,
      onEndTransitionFn = function onEndTransitionFn(ev) {
    if (support.transitions) {
      this.removeEventListener(transEndEventName, onEndTransitionFn);
    }
    if (self.isFilled) {
      self._submit();
    } else {
      self.el.classList.remove('show-next');
      self.currentNum.innerHTML = self.nextQuestionNum.innerHTML;
      self.questionStatus.removeChild(self.nextQuestionNum);
      // force the focus on the next input
      nextQuestion.querySelector('input').focus();
    }
  };

  if (support.transitions) {
    this.progress.addEventListener(transEndEventName, onEndTransitionFn);
  } else {
    onEndTransitionFn();
  }
};

// updates the progress bar by setting its width
stepsForm.prototype._progress = function () {
  this.progress.style.width = this.current * (100 / this.questionsCount) + '%';
};

// changes the current question number
stepsForm.prototype._updateQuestionNumber = function () {
  // first, create next question number placeholder
  this.nextQuestionNum = document.createElement('span');
  this.nextQuestionNum.className = 'number-next';
  this.nextQuestionNum.innerHTML = Number(this.current + 1);
  // insert it in the DOM
  this.questionStatus.appendChild(this.nextQuestionNum);
};

// submits the form
stepsForm.prototype._submit = function () {
  this.options.onSubmit(this.el);
};

// TODO (next version..)
// the validation function
stepsForm.prototype._validade = function () {
  // current questionÂ´s input
  var field = this.questions[this.current].querySelector('input');
  var input = field.value;

  if (input === '') {
    this._showError('EMPTYSTR');
    return false;
  }

  if (field.getAttribute('type') === 'email' && !validateEmail(input)) {
    this._showError('INVALIDEMAIL');
    return false;
  }

  return true;
};

// TODO (next version..)
stepsForm.prototype._showError = function (err) {
  var message = '';
  switch (err) {
    case 'EMPTYSTR':
      message = 'Please fill the field before continuing';
      break;
    case 'INVALIDEMAIL':
      message = 'Please fill a valid email address';
      break;
    // ...
  };
  this.error.innerHTML = message;
  this.error.classList.add('show');
};

// clears/hides the current error message
stepsForm.prototype._clearError = function () {
  this.error.classList.remove('show');
};

function validateEmail(email) {
  var re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
  return re.test(email);
}

// add to global namespace
module.exports = stepsForm;

},{}],"/Applications/MAMP/htdocs/openfoundry/prototype/form-dynamic/scripts/submission.js":[function(require,module,exports){
'use strict';

;(function () {
  var form = document.getElementById('theForm');

  if (!form) {
    return;
  }

  var stepsForm = require("/Applications/MAMP/htdocs/openfoundry/prototype/form-dynamic/scripts/stepsform.js");

  new stepsForm(form, { onSubmit: onSubmit });

  function onSubmit(form) {
    // hide form
    form.querySelector('.simform-inner').classList.add('hide');

    // show loading spinner

    $.ajax({
      url: form.getAttribute('action'),
      type: 'post',
      dataType: 'json',
      data: $(form).serialize(),
      success: onSuccess
    });
  }

  function onSuccess(data) {
    // hide loading spinner

    var messageEl = form.querySelector('.final-message');

    if (data.status === 'success') {
      messageEl.innerHTML = data.message;
    } else {
      messageEl.innerHTML = 'Sorry';
    }
    messageEl.classList.add('show');
  }
})();

},{"/Applications/MAMP/htdocs/openfoundry/prototype/form-dynamic/scripts/stepsform.js":"/Applications/MAMP/htdocs/openfoundry/prototype/form-dynamic/scripts/stepsform.js"}]},{},["./scripts/main.js"])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvQXBwbGljYXRpb25zL01BTVAvaHRkb2NzL29wZW5mb3VuZHJ5L3Byb3RvdHlwZS9mb3JtLWR5bmFtaWMvc2NyaXB0cy9tYWluLmpzIiwiL0FwcGxpY2F0aW9ucy9NQU1QL2h0ZG9jcy9vcGVuZm91bmRyeS9wcm90b3R5cGUvZm9ybS1keW5hbWljL3NjcmlwdHMvbmV3c2xldHRlci5qcyIsIi9BcHBsaWNhdGlvbnMvTUFNUC9odGRvY3Mvb3BlbmZvdW5kcnkvcHJvdG90eXBlL2Zvcm0tZHluYW1pYy9zY3JpcHRzL3N0ZXBzZm9ybS5qcyIsIi9BcHBsaWNhdGlvbnMvTUFNUC9odGRvY3Mvb3BlbmZvdW5kcnkvcHJvdG90eXBlL2Zvcm0tZHluYW1pYy9zY3JpcHRzL3N1Ym1pc3Npb24uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBLElBQUksVUFBVSxHQUFHLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQTtBQUN4QyxJQUFJLFVBQVUsR0FBRyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUE7Ozs7O0FDRHhDLENBQUMsQUFBQyxDQUFBLFlBQVk7O0FBRVosTUFBSSxJQUFJLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFBO0FBQ3JELE1BQUksQ0FBQyxJQUFJLEVBQUU7QUFBRSxXQUFNO0dBQUU7O0FBRXJCLE1BQUksU0FBUyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUUsZ0JBQWdCLENBQUUsQ0FBQTs7QUFFdEQsTUFBSSxTQUFTLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFBOztBQUV0QyxNQUFJLFNBQVMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQTs7QUFFM0MsV0FBUyxRQUFRLENBQUUsSUFBSSxFQUFFOzs7QUFHdkIsUUFBSSxDQUFDLGFBQWEs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Y0FBYyxDQUFDLFNBQVMsQ0FBQyxDQUFBOztBQUU3QyxNQUFJLENBQUMsSUFBSSxFQUFFO0FBQ1QsV0FBTTtHQUNQOztBQUVELE1BQUksU0FBUyxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQTs7QUFFdEMsTUFBSSxTQUFTLENBQUMsSUFBSSxFQUFFLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUE7O0FBRzNDLFdBQVMsUUFBUSxDQUFFLElBQUksRUFBRTs7QUFFdkIsUUFBSSxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUE7Ozs7QUFJMUQsS0FBQyxDQUFDLElBQUksQ0FBQztBQUNMLFNBQUcsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQztBQUNoQyxVQUFJLEVBQUUsTUFBTTtBQUNaLGNBQVEsRUFBRSxNQUFNO0FBQ2hCLFVBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxFQUFFO0FBQ3pCLGFBQU8sRUFBRSxTQUFTO0tBQ25CLENBQUMsQ0FBQTtHQUNIOztBQUVELFdBQVMsU0FBUyxDQUFFLElBQUksRUFBRTs7O0FBR3hCLFFBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUUsZ0JBQWdCLENBQUUsQ0FBQTs7QUFFdEQsUUFBSSxJQUFJLENBQUMsTUFBTSxLQUFLLFNBQVMsRUFBRTtBQUM3QixlQUFTLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUE7S0FDbkMsTUFBTTtBQUNMLGVBQVMsQ0FBQyxTQUFTLEdBQUcsT0FBTyxDQUFBO0tBQzlCO0FBQ0QsYUFBUyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUE7R0FDaEM7Q0FFRixDQUFBLEVBQUUsQ0FBQyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJ2YXIgc3VibWlzc2lvbiA9IHJlcXVpcmUoJy4vc3VibWlzc2lvbicpXG52YXIgbmV3c2xldHRlciA9IHJlcXVpcmUoJy4vbmV3c2xldHRlcicpXG4iLCI7KGZ1bmN0aW9uICgpIHtcblxuICB2YXIgZm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXdzbGV0dGVyLWZvcm0nKVxuICBpZiAoIWZvcm0pIHsgcmV0dXJuIH1cblxuICB2YXIgbWVzc2FnZUVsID0gZm9ybS5xdWVyeVNlbGVjdG9yKCAnLmZpbmFsLW1lc3NhZ2UnIClcblxuICB2YXIgc3RlcHNGb3JtID0gcmVxdWlyZSgnLi9zdGVwc2Zvcm0nKVxuXG4gIG5ldyBzdGVwc0Zvcm0oZm9ybSwgeyBvblN1Ym1pdDogb25TdWJtaXQgfSlcblxuICBmdW5jdGlvbiBvblN1Ym1pdCAoZm9ybSkge1xuXG4gICAgLy8gaGlkZSBmb3JtXG4gICAgZm9ybS5xdWVyeVNlbGVjdG9yKCcuc2ltZm9ybS1pbm5lcicpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKVxuXG4gICAgJC5hamF4KHtcbiAgICAgIHVybDogJy9uZXdzbGV0dGVyLXN1Ym1pdCcsXG4gICAgICB0eXBlOiAncG9zdCcsXG4gICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgZGF0YTogJChmb3JtKS5zZXJpYWxpemUoKSxcbiAgICAgIHN1Y2Nlc3M6IG9uU3VjY2Vzc1xuICAgIH0pXG4gIH1cblxuICBmdW5jdGlvbiBvblN1Y2Nlc3MgKGRhdGEpIHtcbiAgICBpZiAoZGF0YS5zdGF0dXMgPT09ICdzdWNjZXNzJykge1xuICAgICAgbWVzc2FnZUVsLmlubmVySFRNTCA9IGRhdGEubWVzc2FnZVxuICAgIH0gZWxzZSB7XG4gICAgICBtZXNzYWdlRWwuaW5uZXJIVE1MID0gZGF0YS5tZXNzYWdlXG4gICAgfVxuICAgIG1lc3NhZ2VFbC5jbGFzc0xpc3QuYWRkKCdzaG93JylcbiAgfVxuXG59KCkpIiwiLyoqXG4gKiBzdGVwc0Zvcm0uanMgdjEuMC4wXG4gKiBodHRwOi8vd3d3LmNvZHJvcHMuY29tXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLlxuICogaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHBcbiAqXG4gKiBDb3B5cmlnaHQgMjAxNCwgQ29kcm9wc1xuICogaHR0cDovL3d3dy5jb2Ryb3BzLmNvbVxuICovXG5cblxuJ3VzZSBzdHJpY3QnO1xuXG52YXIgdHJhbnNFbmRFdmVudE5hbWVzID0ge1xuICAgICdXZWJraXRUcmFuc2l0aW9uJzogJ3dlYmtpdFRyYW5zaXRpb25FbmQnLFxuICAgICdNb3pUcmFuc2l0aW9uJzogJ3RyYW5zaXRpb25lbmQnLFxuICAgICdPVHJhbnNpdGlvbic6ICdvVHJhbnNpdGlvbkVuZCcsXG4gICAgJ21zVHJhbnNpdGlvbic6ICdNU1RyYW5zaXRpb25FbmQnLFxuICAgICd0cmFuc2l0aW9uJzogJ3RyYW5zaXRpb25lbmQnXG4gIH0sXG4gIHRyYW5zRW5kRXZlbnROYW1lID0gdHJhbnNFbmRFdmVudE5hbWVzWyBNb2Rlcm5penIucHJlZml4ZWQoICd0cmFuc2l0aW9uJyApIF0sXG4gIHN1cHBvcnQgPSB7IHRyYW5zaXRpb25zIDogTW9kZXJuaXpyLmNzc3RyYW5zaXRpb25zIH07XG5cbmZ1bmN0aW9uIGV4dGVuZCggYSwgYiApIHtcbiAgZm9yKCB2YXIga2V5IGluIGIgKSB7XG4gICAgaWYoIGIuaGFzT3duUHJvcGVydHkoIGtleSApICkge1xuICAgICAgYVtrZXldID0gYltrZXldO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYTtcbn1cblxuZnVuY3Rpb24gc3RlcHNGb3JtKCBlbCwgb3B0aW9ucyApIHtcbiAgdGhpcy5lbCA9IGVsO1xuICB0aGlzLm9wdGlvbnMgPSBleHRlbmQoIHt9LCB0aGlzLm9wdGlvbnMgKTtcbiAgICBleHRlbmQoIHRoaXMub3B0aW9ucywgb3B0aW9ucyApO1xuICAgIHRoaXMuX2luaXQoKTtcbn1cblxuc3RlcHNGb3JtLnByb3RvdHlwZS5vcHRpb25zID0ge1xuICBvblN1Ym1pdCA6IGZ1bmN0aW9uKCkgeyByZXR1cm4gZmFsc2U7IH1cbn07XG5cbnN0ZXBzRm9ybS5wcm90b3R5cGUuX2luaXQgPSBmdW5jdGlvbigpIHtcbiAgLy8gY3VycmVudCBxdWVzdGlvblxuICB0aGlzLmN1cnJlbnQgPSAwO1xuXG4gIC8vIHF1ZXN0aW9uc1xuICB0aGlzLnF1ZXN0aW9ucyA9IFtdLnNsaWNlLmNhbGwoIHRoaXMuZWwucXVlcnlTZWxlY3RvckFsbCggJ29sLnF1ZXN0aW9ucyA+IGxpJyApICk7XG5cbiAgLy8gdG90YWwgcXVlc3Rpb25zXG4gIHRoaXMucXVlc3Rpb25zQ291bnQgPSB0aGlzLnF1ZXN0aW9ucy5sZW5ndGg7XG5cbiAgLy8gc2hvdyBmaXJzdCBxdWVzdGlvblxuICB0aGlzLnF1ZXN0aW9uc1swXS5jbGFzc0xpc3QuYWRkKCdjdXJyZW50JyApO1xuXG4gIC8vIG5leHQgcXVlc3Rpb24gY29udHJvbFxuICB0aGlzLmN0cmxOZXh0ID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCAnYnV0dG9uLm5leHQnICk7XG5cbiAgLy8gcHJvZ3Jlc3MgYmFyXG4gIHRoaXMucHJvZ3Jlc3MgPSB0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IoICdkaXYucHJvZ3Jlc3MnICk7XG5cbiAgLy8gcXVlc3Rpb24gbnVtYmVyIHN0YXR1c1xuICB0aGlzLnF1ZXN0aW9uU3RhdHVzID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCAnc3Bhbi5udW1iZXInICk7XG5cbiAgLy8gY3VycmVudCBxdWVzdGlvbiBwbGFjZWhvbGRlclxuICB0aGlzLmN1cnJlbnROdW0gPSB0aGlzLnF1ZXN0aW9uU3RhdHVzLnF1ZXJ5U2VsZWN0b3IoICdzcGFuLm51bWJlci1jdXJyZW50JyApO1xuICB0aGlzLmN1cnJlbnROdW0uaW5uZXJIVE1MID0gTnVtYmVyKCB0aGlzLmN1cnJlbnQgKyAxICk7XG5cbiAgLy8gdG90YWwgcXVlc3Rpb25zIHBsYWNlaG9sZGVyXG4gIHRoaXMudG90YWxRdWVzdGlvbk51bSA9IHRoaXMucXVlc3Rpb25TdGF0dXMucXVlcnlTZWxlY3RvciggJ3NwYW4ubnVtYmVyLXRvdGFsJyApO1xuICB0aGlzLnRvdGFsUXVlc3Rpb25OdW0uaW5uZXJIVE1MID0gdGhpcy5xdWVzdGlvbnNDb3VudDtcblxuICAvLyBlcnJvciBtZXNzYWdlXG4gIHRoaXMuZXJyb3IgPSB0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IoICdzcGFuLmVycm9yLW1lc3NhZ2UnICk7XG5cbiAgLy8gaW5pdCBldmVudHNcbiAgdGhpcy5faW5pdEV2ZW50cygpO1xufTtcblxuc3RlcHNGb3JtLnByb3RvdHlwZS5faW5pdEV2ZW50cyA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgLy8gZmlyc3QgaW5wdXRcbiAgICBmaXJzdEVsSW5wdXQgPSB0aGlzLnF1ZXN0aW9uc1sgdGhpcy5jdXJyZW50IF0ucXVlcnlTZWxlY3RvciggJ2lucHV0JyApLFxuICAgIC8vIGZvY3VzXG4gICAgb25Gb2N1c1N0YXJ0Rm4gPSBmdW5jdGlvbigpIHtcbiAgICAgIGZpcnN0RWxJbnB1dC5yZW1vdmVFdmVudExpc3RlbmVyKCAnZm9jdXMnLCBvbkZvY3VzU3RhcnRGbiApO1xuICAgICAgc2VsZi5jdHJsTmV4dC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7XG4gICAgfTtcblxuICAvLyBzaG93IHRoZSBuZXh0IHF1ZXN0aW9uIGNvbnRyb2wgZmlyc3QgdGltZSB0aGUgaW5wdXQgZ2V0cyBmb2N1c2VkXG4gIGZpcnN0RWxJbnB1dC5hZGRFdmVudExpc3RlbmVyKCAnZm9jdXMnLCBvbkZvY3VzU3RhcnRGbiApO1xuXG4gIC8vIHNob3cgbmV4dCBxdWVzdGlvblxuICB0aGlzLmN0cmxOZXh0LmFkZEV2ZW50TGlzdGVuZXIoICdjbGljaycsIGZ1bmN0aW9uKCBldiApIHtcbiAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHNlbGYuX25leHRRdWVzdGlvbigpO1xuICB9ICk7XG5cbiAgLy8gcHJlc3NpbmcgZW50ZXIgd2lsbCBqdW1wIHRvIG5leHQgcXVlc3Rpb25cbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ2tleWRvd24nLCBmdW5jdGlvbiggZXYgKSB7XG4gICAgdmFyIGtleUNvZGUgPSBldi5rZXlDb2RlIHx8IGV2LndoaWNoO1xuICAgIC8vIGVudGVyXG4gICAgaWYoIGtleUNvZGUgPT09IDEzICkge1xuICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHNlbGYuX25leHRRdWVzdGlvbigpO1xuICAgIH1cbiAgfSApO1xuXG4gIC8vIGRpc2FibGUgdGFiXG4gIHRoaXMuZWwuYWRkRXZlbnRMaXN0ZW5lciggJ2tleWRvd24nLCBmdW5jdGlvbiggZXYgKSB7XG4gICAgdmFyIGtleUNvZGUgPSBldi5rZXlDb2RlIHx8IGV2LndoaWNoO1xuICAgIC8vIHRhYlxuICAgIGlmKCBrZXlDb2RlID09PSA5ICkge1xuICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gIH0gKTtcbn07XG5cbnN0ZXBzRm9ybS5wcm90b3R5cGUuX25leHRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xuICBpZiggIXRoaXMuX3ZhbGlkYWRlKCkgKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLy8gY2hlY2sgaWYgZm9ybSBpcyBmaWxsZWRcbiAgaWYoIHRoaXMuY3VycmVudCA9PT0gdGhpcy5xdWVzdGlvbnNDb3VudCAtIDEgKSB7XG4gICAgdGhpcy5pc0ZpbGxlZCA9IHRydWU7XG4gIH1cblxuICAvLyBjbGVhciBhbnkgcHJldmlvdXMgZXJyb3IgbWVzc2FnZXNcbiAgdGhpcy5fY2xlYXJFcnJvcigpO1xuXG4gIC8vIGN1cnJlbnQgcXVlc3Rpb25cbiAgdmFyIGN1cnJlbnRRdWVzdGlvbiA9IHRoaXMucXVlc3Rpb25zWyB0aGlzLmN1cnJlbnQgXTtcblxuICAvLyBpbmNyZW1lbnQgY3VycmVudCBxdWVzdGlvbiBpdGVyYXRvclxuICArK3RoaXMuY3VycmVudDtcblxuICAvLyB1cGRhdGUgcHJvZ3Jlc3MgYmFyXG4gIHRoaXMuX3Byb2dyZXNzKCk7XG5cbiAgaWYoICF0aGlzLmlzRmlsbGVkICkge1xuICAgIC8vIGNoYW5nZSB0aGUgY3VycmVudCBxdWVzdGlvbiBudW1iZXIvc3RhdHVzXG4gICAgdGhpcy5fdXBkYXRlUXVlc3Rpb25OdW1iZXIoKTtcblxuICAgIC8vIGFkZCBjbGFzcyBcInNob3ctbmV4dFwiIHRvIGZvcm0gZWxlbWVudCAoc3RhcnQgYW5pbWF0aW9ucylcbiAgICB0aGlzLmVsLmNsYXNzTGlzdC5hZGQoJ3Nob3ctbmV4dCcpO1xuXG4gICAgLy8gcmVtb3ZlIGNsYXNzIFwiY3VycmVudFwiIGZyb20gY3VycmVudCBxdWVzdGlvbiBhbmQgYWRkIGl0IHRvIHRoZSBuZXh0IG9uZVxuICAgIC8vIGN1cnJlbnQgcXVlc3Rpb25cbiAgICB2YXIgbmV4dFF1ZXN0aW9uID0gdGhpcy5xdWVzdGlvbnNbIHRoaXMuY3VycmVudCBdO1xuICAgIGN1cnJlbnRRdWVzdGlvbi5jbGFzc0xpc3QucmVtb3ZlKCdjdXJyZW50Jyk7XG4gICAgbmV4dFF1ZXN0aW9uLmNsYXNzTGlzdC5hZGQoJ2N1cnJlbnQnKTtcbiAgfVxuXG4gIC8vIGFmdGVyIGFuaW1hdGlvbiBlbmRzLCByZW1vdmUgY2xhc3MgXCJzaG93LW5leHRcIiBmcm9tIGZvcm0gZWxlbWVudCBhbmQgY2hhbmdlIGN1cnJlbnQgcXVlc3Rpb24gcGxhY2Vob2xkZXJcbiAgdmFyIHNlbGYgPSB0aGlzLFxuICAgIG9uRW5kVHJhbnNpdGlvbkZuID0gZnVuY3Rpb24oIGV2ICkge1xuICAgICAgaWYoIHN1cHBvcnQudHJhbnNpdGlvbnMgKSB7XG4gICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lciggdHJhbnNFbmRFdmVudE5hbWUsIG9uRW5kVHJhbnNpdGlvbkZuICk7XG4gICAgICB9XG4gICAgICBpZiggc2VsZi5pc0ZpbGxlZCApIHtcbiAgICAgICAgc2VsZi5fc3VibWl0KCk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgc2VsZi5lbC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93LW5leHQnKTtcbiAgICAgICAgc2VsZi5jdXJyZW50TnVtLmlubmVySFRNTCA9IHNlbGYubmV4dFF1ZXN0aW9uTnVtLmlubmVySFRNTDtcbiAgICAgICAgc2VsZi5xdWVzdGlvblN0YXR1cy5yZW1vdmVDaGlsZCggc2VsZi5uZXh0UXVlc3Rpb25OdW0gKTtcbiAgICAgICAgLy8gZm9yY2UgdGhlIGZvY3VzIG9uIHRoZSBuZXh0IGlucHV0XG4gICAgICAgIG5leHRRdWVzdGlvbi5xdWVyeVNlbGVjdG9yKCAnaW5wdXQnICkuZm9jdXMoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gIGlmKCBzdXBwb3J0LnRyYW5zaXRpb25zICkge1xuICAgIHRoaXMucHJvZ3Jlc3MuYWRkRXZlbnRMaXN0ZW5lciggdHJhbnNFbmRFdmVudE5hbWUsIG9uRW5kVHJhbnNpdGlvbkZuICk7XG4gIH1cbiAgZWxzZSB7XG4gICAgb25FbmRUcmFuc2l0aW9uRm4oKTtcbiAgfVxufVxuXG4vLyB1cGRhdGVzIHRoZSBwcm9ncmVzcyBiYXIgYnkgc2V0dGluZyBpdHMgd2lkdGhcbnN0ZXBzRm9ybS5wcm90b3R5cGUuX3Byb2dyZXNzID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMucHJvZ3Jlc3Muc3R5bGUud2lkdGggPSB0aGlzLmN1cnJlbnQgKiAoIDEwMCAvIHRoaXMucXVlc3Rpb25zQ291bnQgKSArICclJztcbn1cblxuLy8gY2hhbmdlcyB0aGUgY3VycmVudCBxdWVzdGlvbiBudW1iZXJcbnN0ZXBzRm9ybS5wcm90b3R5cGUuX3VwZGF0ZVF1ZXN0aW9uTnVtYmVyID0gZnVuY3Rpb24oKSB7XG4gIC8vIGZpcnN0LCBjcmVhdGUgbmV4dCBxdWVzdGlvbiBudW1iZXIgcGxhY2Vob2xkZXJcbiAgdGhpcy5uZXh0UXVlc3Rpb25OdW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnc3BhbicgKTtcbiAgdGhpcy5uZXh0UXVlc3Rpb25OdW0uY2xhc3NOYW1lID0gJ251bWJlci1uZXh0JztcbiAgdGhpcy5uZXh0UXVlc3Rpb25OdW0uaW5uZXJIVE1MID0gTnVtYmVyKCB0aGlzLmN1cnJlbnQgKyAxICk7XG4gIC8vIGluc2VydCBpdCBpbiB0aGUgRE9NXG4gIHRoaXMucXVlc3Rpb25TdGF0dXMuYXBwZW5kQ2hpbGQoIHRoaXMubmV4dFF1ZXN0aW9uTnVtICk7XG59XG5cbi8vIHN1Ym1pdHMgdGhlIGZvcm1cbnN0ZXBzRm9ybS5wcm90b3R5cGUuX3N1Ym1pdCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLm9wdGlvbnMub25TdWJtaXQoIHRoaXMuZWwgKTtcbn1cblxuLy8gVE9ETyAobmV4dCB2ZXJzaW9uLi4pXG4vLyB0aGUgdmFsaWRhdGlvbiBmdW5jdGlvblxuc3RlcHNGb3JtLnByb3RvdHlwZS5fdmFsaWRhZGUgPSBmdW5jdGlvbigpIHtcbiAgLy8gY3VycmVudCBxdWVzdGlvbsK0cyBpbnB1dFxuICB2YXIgZmllbGQgPSB0aGlzLnF1ZXN0aW9uc1sgdGhpcy5jdXJyZW50IF0ucXVlcnlTZWxlY3RvciggJ2lucHV0JyApXG4gIHZhciBpbnB1dCA9IGZpZWxkLnZhbHVlO1xuXG4gIGlmKCBpbnB1dCA9PT0gJycgKSB7XG4gICAgdGhpcy5fc2hvd0Vycm9yKCAnRU1QVFlTVFInICk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaWYoIGZpZWxkLmdldEF0dHJpYnV0ZSgndHlwZScpID09PSAnZW1haWwnICYmICF2YWxpZGF0ZUVtYWlsKGlucHV0KSApIHtcbiAgICB0aGlzLl9zaG93RXJyb3IoICdJTlZBTElERU1BSUwnICk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5cbi8vIFRPRE8gKG5leHQgdmVyc2lvbi4uKVxuc3RlcHNGb3JtLnByb3RvdHlwZS5fc2hvd0Vycm9yID0gZnVuY3Rpb24oIGVyciApIHtcbiAgdmFyIG1lc3NhZ2UgPSAnJztcbiAgc3dpdGNoKCBlcnIgKSB7XG4gICAgY2FzZSAnRU1QVFlTVFInIDpcbiAgICAgIG1lc3NhZ2UgPSAnUGxlYXNlIGZpbGwgdGhlIGZpZWxkIGJlZm9yZSBjb250aW51aW5nJztcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ0lOVkFMSURFTUFJTCcgOlxuICAgICAgbWVzc2FnZSA9ICdQbGVhc2UgZmlsbCBhIHZhbGlkIGVtYWlsIGFkZHJlc3MnO1xuICAgICAgYnJlYWs7XG4gICAgLy8gLi4uXG4gIH07XG4gIHRoaXMuZXJyb3IuaW5uZXJIVE1MID0gbWVzc2FnZTtcbiAgdGhpcy5lcnJvci5jbGFzc0xpc3QuYWRkKCdzaG93JyApO1xufVxuXG4vLyBjbGVhcnMvaGlkZXMgdGhlIGN1cnJlbnQgZXJyb3IgbWVzc2FnZVxuc3RlcHNGb3JtLnByb3RvdHlwZS5fY2xlYXJFcnJvciA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmVycm9yLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcbn1cblxuZnVuY3Rpb24gdmFsaWRhdGVFbWFpbChlbWFpbCkge1xuICB2YXIgcmUgPSAvXigoW148PigpW1xcXVxcXFwuLDs6XFxzQFwiXSsoXFwuW148PigpW1xcXVxcXFwuLDs6XFxzQFwiXSspKil8KFwiLitcIikpQCgoXFxbWzAtOV17MSwzfVxcLlswLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfV0pfCgoW2EtekEtWlxcLTAtOV0rXFwuKStbYS16QS1aXXsyLH0pKSQvO1xuICByZXR1cm4gcmUudGVzdChlbWFpbCk7XG59XG5cbi8vIGFkZCB0byBnbG9iYWwgbmFtZXNwYWNlXG5tb2R1bGUuZXhwb3J0cyA9IHN0ZXBzRm9ybTsiLCI7KGZ1bmN0aW9uICgpIHtcbiAgdmFyIGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGhlRm9ybScpXG5cbiAgaWYgKCFmb3JtKSB7XG4gICAgcmV0dXJuXG4gIH1cblxuICB2YXIgc3RlcHNGb3JtID0gcmVxdWlyZSgnLi9zdGVwc2Zvcm0nKVxuXG4gIG5ldyBzdGVwc0Zvcm0oZm9ybSwgeyBvblN1Ym1pdDogb25TdWJtaXQgfSlcblxuXG4gIGZ1bmN0aW9uIG9uU3VibWl0IChmb3JtKSB7XG4gICAgLy8gaGlkZSBmb3JtXG4gICAgZm9ybS5xdWVyeVNlbGVjdG9yKCcuc2ltZm9ybS1pbm5lcicpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKVxuXG4gICAgLy8gc2hvdyBsb2FkaW5nIHNwaW5uZXJcblxuICAgICQuYWpheCh7XG4gICAgICB1cmw6IGZvcm0uZ2V0QXR0cmlidXRlKCdhY3Rpb24nKSxcbiAgICAgIHR5cGU6ICdwb3N0JyxcbiAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICBkYXRhOiAkKGZvcm0pLnNlcmlhbGl6ZSgpLFxuICAgICAgc3VjY2Vzczogb25TdWNjZXNzXG4gICAgfSlcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU3VjY2VzcyAoZGF0YSkge1xuICAgIC8vIGhpZGUgbG9hZGluZyBzcGlubmVyXG5cbiAgICB2YXIgbWVzc2FnZUVsID0gZm9ybS5xdWVyeVNlbGVjdG9yKCAnLmZpbmFsLW1lc3NhZ2UnIClcblxuICAgIGlmIChkYXRhLnN0YXR1cyA9PT0gJ3N1Y2Nlc3MnKSB7XG4gICAgICBtZXNzYWdlRWwuaW5uZXJIVE1MID0gZGF0YS5tZXNzYWdlXG4gICAgfSBlbHNlIHtcbiAgICAgIG1lc3NhZ2VFbC5pbm5lckhUTUwgPSAnU29ycnknXG4gICAgfVxuICAgIG1lc3NhZ2VFbC5jbGFzc0xpc3QuYWRkKCdzaG93JylcbiAgfVxuXG59KCkpXG4iXX0=
